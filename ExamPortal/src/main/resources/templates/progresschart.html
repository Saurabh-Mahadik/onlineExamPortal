<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Student Progress Histogram</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    /* Chart container */
    .histogram {
      display: flex;
      align-items: flex-end;
      gap: 1rem;
      padding: 1.5rem;
      min-height: 240px;
      border-radius: .5rem;
      background: #f8f9fa;
      overflow-x: auto;
    }

    /* Each bar column */
    .bar-column {
      display: flex;
      flex-direction: column;
      align-items: center;
      width: 64px;
      min-width: 64px;
    }

    /* The visual bar */
    .bar {
      width: 100%;
      border-radius: .35rem .35rem 0 0;
      background: linear-gradient(180deg, rgba(13,110,253,0.95), rgba(13,110,253,0.7));
      display: flex;
      align-items: flex-end;
      justify-content: center;
      transition: transform 200ms ease, box-shadow 200ms ease;
      box-shadow: 0 2px 6px rgba(0,0,0,0.08);
      cursor: pointer;
    }

    .bar:hover {
      transform: translateY(-6px);
      box-shadow: 0 8px 20px rgba(0,0,0,0.12);
    }

    /* value label inside bar */
    .bar .value {
      color: white;
      font-weight: 700;
      font-size: .85rem;
      padding: .25rem;
      text-shadow: 0 1px 1px rgba(0,0,0,0.35);
    }

    /* student name below */
    .label {
      margin-top: .5rem;
      font-size: .85rem;
      text-align: center;
      word-break: break-word;
    }

    /* grid lines (horizontal) */
    .grid-lines {
      position: relative;
    }

    .grid-lines::before {
      content: '';
      position: absolute;
      left: 0; right: 0; top: 0; bottom: 0;
      background-image: linear-gradient(to top, rgba(0,0,0,0.04) 1px, transparent 1px);
      background-size: 100% 24px; /* spacing between lines */
      pointer-events: none;
      border-radius: .5rem;
    }

    @media (max-width: 480px) {
      .bar-column { width: 48px; min-width: 48px; }
      .bar .value { font-size: .7rem; }
    }
  </style>
</head>
<body class="bg-white text-dark">
  <div class="container py-5">
    <div class="d-flex justify-content-between align-items-start mb-3">
      <div>
        <h2 class="mb-0">Student Progress Histogram</h2>
        <small class="text-muted">Visualize student scores (%) — responsive, accessible, and editable</small>
      </div>
      <div>
        <button id="resetBtn" class="btn btn-outline-secondary">Reset sample data</button>
      </div>
    </div>

    <div class="row g-4">
      <div class="col-lg-8">
        <div class="card">
          <div class="card-body">
            <div class="d-flex justify-content-between mb-2">
              <div><strong>Scores (0 - 100%)</strong></div>
              <div class="text-muted">Hover a bar for exact value. Click to toggle highlight.</div>
            </div>

            <div id="chartWrapper" class="grid-lines" aria-label="Student scores histogram">
              <div id="histogram" class="histogram" role="list" aria-live="polite"></div>
            </div>

            <div class="mt-3 d-flex justify-content-between">
              <small class="text-muted">Max: <span id="maxVal">100</span>%</small>
              <small class="text-muted">Min: <span id="minVal">0</span>%</small>
            </div>
          </div>
        </div>
      </div>

      <div class="col-lg-4">
        <div class="card">
          <div class="card-body">
            <h5 class="card-title">Add / Edit Students</h5>
            <form id="addForm" class="mb-3" aria-label="Add student form">
              <div class="mb-2">
                <label for="studentName" class="form-label">Name</label>
                <input id="studentName" type="text" class="form-control" placeholder="e.g. Rohit" required>
              </div>
              <div class="mb-2">
                <label for="studentScore" class="form-label">Score (%)</label>
                <input id="studentScore" type="number" class="form-control" placeholder="0 - 100" min="0" max="100" required>
              </div>
              <div class="d-grid">
                <button class="btn btn-primary" type="submit">Add student</button>
              </div>
            </form>

            <div class="mb-3">
              <label class="form-label">Sample students</label>
              <ul id="studentsList" class="list-group list-group-flush small"></ul>
            </div>

            <div class="d-grid">
              <button id="exportBtn" class="btn btn-outline-success">Export data (JSON)</button>
            </div>
          </div>
        </div>

      </div>
    </div>

    <footer class="mt-4 text-muted small">Tip: Click a bar to pin/unpin highlight. Use the form to add new students.</footer>
  </div>

  <script>
    // Sample data
    const sampleData = [
      { name: 'Aisha', score: 92 },
      { name: 'Rohan', score: 78 },
      { name: 'Meera', score: 64 },
      { name: 'Vikas', score: 52 },
      { name: 'Sneha', score: 88 },
      { name: 'Aditya', score: 45 },
      { name: 'Priya', score: 73 },
      { name: 'Karan', score: 36 }
    ];

    let students = JSON.parse(JSON.stringify(sampleData)); // deep copy

    const histogram = document.getElementById('histogram');
    const studentsList = document.getElementById('studentsList');
    const addForm = document.getElementById('addForm');
    const studentNameEl = document.getElementById('studentName');
    const studentScoreEl = document.getElementById('studentScore');
    const exportBtn = document.getElementById('exportBtn');
    const resetBtn = document.getElementById('resetBtn');

    function render() {
      histogram.innerHTML = '';
      studentsList.innerHTML = '';

      // Determine max for scaling (keep at least 100)
      const maxScore = Math.max(100, ...students.map(s => s.score));
      document.getElementById('maxVal').textContent = maxScore;

      students.forEach((s, i) => {
        const col = document.createElement('div');
        col.className = 'bar-column';
        col.setAttribute('role', 'listitem');

        const bar = document.createElement('div');
        bar.className = 'bar';
        // height percentage relative to maxScore; ensure minimum visible height for 0
        const heightPct = (s.score / maxScore) * 100;
        bar.style.height = Math.max(6, heightPct) + '%';
        bar.title = `${s.name}: ${s.score}%`;
        bar.tabIndex = 0;
        bar.dataset.index = i;

        const value = document.createElement('div');
        value.className = 'value';
        value.textContent = s.score + '%';
        bar.appendChild(value);

        // interactions
        bar.addEventListener('click', () => {
          bar.classList.toggle('active');
          if (bar.classList.contains('active')) {
            bar.style.outline = '3px solid rgba(13,110,253,0.22)';
            bar.style.boxShadow = '0 12px 28px rgba(13,110,253,0.18)';
          } else {
            bar.style.outline = '';
            bar.style.boxShadow = '';
          }
        });
        bar.addEventListener('keydown', (ev) => {
          if (ev.key === 'Enter' || ev.key === ' ') bar.click();
        });

        col.appendChild(bar);

        const label = document.createElement('div');
        label.className = 'label';
        label.textContent = s.name;
        col.appendChild(label);

        histogram.appendChild(col);

        // students list (for quick edit/remove)
        const li = document.createElement('li');
        li.className = 'list-group-item d-flex justify-content-between align-items-center';
        li.innerHTML = `<div><strong>${escapeHtml(s.name)}</strong><div class='text-muted small'>${s.score}%</div></div>`;

        const btnGroup = document.createElement('div');
        btnGroup.className = 'btn-group';

        const editBtn = document.createElement('button');
        editBtn.className = 'btn btn-sm btn-outline-primary';
        editBtn.textContent = 'Edit';
        editBtn.onclick = () => {
          const newName = prompt('Edit name', s.name);
          if (newName === null) return;
          const newScore = prompt('Edit score (0-100)', s.score);
          if (newScore === null) return;
          const parsed = Number(newScore);
          if (Number.isFinite(parsed) && parsed >= 0 && parsed <= 100) {
            students[i].name = newName.trim() || s.name;
            students[i].score = parsed;
            render();
          } else {
            alert('Invalid score — must be 0 to 100.');
          }
        };

        const delBtn = document.createElement('button');
        delBtn.className = 'btn btn-sm btn-outline-danger';
        delBtn.textContent = 'Remove';
        delBtn.onclick = () => {
          if (confirm(`Remove ${s.name}?`)) {
            students.splice(i, 1);
            render();
          }
        };

        btnGroup.appendChild(editBtn);
        btnGroup.appendChild(delBtn);
        li.appendChild(btnGroup);

        studentsList.appendChild(li);
      });
    }

    // Form handling
    addForm.addEventListener('submit', (e) => {
      e.preventDefault();
      const name = studentNameEl.value.trim();
      const score = Number(studentScoreEl.value);
      if (!name) return alert('Enter a name');
      if (!Number.isFinite(score) || score < 0 || score > 100) return alert('Score must be between 0 and 100');
      students.push({ name, score });
      studentNameEl.value = '';
      studentScoreEl.value = '';
      render();
    });

    exportBtn.addEventListener('click', () => {
      const dataStr = JSON.stringify(students, null, 2);
      // download as file
      const blob = new Blob([dataStr], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'students-data.json';
      a.click();
      URL.revokeObjectURL(url);
    });

    resetBtn.addEventListener('click', () => {
      if (confirm('Reset to the original sample data?')) {
        students = JSON.parse(JSON.stringify(sampleData));
        render();
      }
    });

    // Utility: escape HTML for list rendering
    function escapeHtml(s) {
      return s.replace(/[&<>"']/g, c => ({
        '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":"&#39;"
      }[c]));
    }

    // Initial render
    render();
  </script>
</body>
</html>
